<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title th:text="#{member.details.title}">Member Details</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}" />
    <link rel="stylesheet" th:href="@{/css/memberDetails.css}" />

    <script th:src="@{/js/sidebar.js}" defer></script>
    <script th:src="@{/js/memberDetails.js}" defer></script>
</head>
<body>
<div th:replace="~{fragments :: sidebar}"></div>

<div class="members-container container">
    <div class="top-bar">
        <div class="top-bar-left">
            <a th:href="@{/members}" class="go-back-btn">
                <i class="bi bi-arrow-left"></i> <span th:text="#{button.goBack}">Go Back</span>
            </a>
            <h1 class="title" th:text="#{member.details.title}">Member Details</h1>
        </div>
        <div class="top-bar-right">
            <a th:href="@{/members/{id}/pdf(id=${member.id})}" class="btn-generate-pdf">
                <i class="bi bi-file-earmark-pdf"></i> <span th:text="#{button.generatePdf}">Generate PDF</span>
            </a>
        </div>
    </div>

    <div class="row">
        <!-- Left Panel -->
        <div class="col-md-4">
            <div class="panel member-info">
                <div class="profile-section">
                    <div class="profile-avatar">
                        <i class="bi bi-person-fill"></i>
                    </div>
                    <h2 class="profile-name">[[${member.firstName}]] [[${member.lastName}]]</h2>
                    <div class="profile-id" th:text="#{member.id} + ': ' + ${member.id}">Member ID: 1</div>
                    <div class="profile-status" th:class="'profile-status ' + ${member.memberStatus}"
                         th:text="#{${'member.status.' + member.memberStatus}}">Active</div>
                </div>

                <div class="personal-details">
                    <h3 class="section-title">
                        <i class="bi bi-person-lines-fill"></i>
                        <span th:text="#{member.personalDetails}">Personal Details</span>
                    </h3>

                    <div class="detail-item">
                        <i class="bi bi-envelope-fill"></i>
                        <span class="detail-label" th:text="#{member.email}">Email:</span>
                        <span class="detail-value" th:text="${member.email}"></span>
                    </div>

                    <div class="detail-item">
                        <i class="bi bi-telephone-fill"></i>
                        <span class="detail-label" th:text="#{member.phone}">Phone:</span>
                        <span class="detail-value" th:text="${member.phoneNumber}"></span>
                    </div>

                    <div class="detail-item">
                        <i class="bi bi-geo-alt-fill"></i>
                        <span class="detail-label" th:text="#{member.address}">Address:</span>
                        <span class="detail-value" th:text="${member.address}"></span>
                    </div>

                    <div class="detail-item">
                        <i class="bi bi-calendar-check-fill"></i>
                        <span class="detail-label" th:text="#{member.lastPayment}">Last Payment:</span>
                        <span class="detail-value" th:text="${member.dateOfLastPayment}"></span>
                    </div>

                    <div class="detail-item">
                        <i class="bi bi-clock-fill"></i>
                        <span class="detail-label" th:text="#{member.createdAt}">Created At:</span>
                        <span class="detail-value" th:text="${#temporals.format(member.createdAt, 'dd MMM, yyyy')}"></span>
                    </div>

                    <button class="send-payment-btn" id="sendPaymentBtn" th:data-member-id="${member.id}">
                        <i class="bi bi-cash-stack"></i> <span th:text="#{button.sendPayment}">Send Payment</span>
                    </button>

                    <!-- Payment Modal -->
                    <div class="modal-overlay hidden" id="paymentModal">
                        <div class="modal-content">
                            <h3 th:text="#{payment.send}">Send Payment</h3>
                            <form id="paymentForm">
                                <div class="form-group">
                                    <label for="paymentType" th:text="#{payment.type}">Payment Type:</label>
                                    <select id="paymentType" name="paymentType" required>
                                        <option value="" th:text="#{select.placeholder}">-- Select --</option>
                                        <option value="MEMBERSHIP_FEE" th:text="#{transaction.type.MEMBERSHIP_FEE}">Membership Fee</option>
                                        <option value="EVENT_PAYMENT" th:text="#{transaction.type.EVENT_PAYMENT}">Event Payment</option>
                                        <option value="DONATION" th:text="#{transaction.type.DONATION}">Donation</option>
                                        <option value="OTHER" th:text="#{transaction.type.OTHER}">Other</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="amount" th:text="#{payment.amount}">Amount:</label>
                                    <input type="number" id="amount" name="amount" th:placeholder="#{payment.amount.placeholder}" step="0.01" min="0.50" required>
                                </div>

                                <div class="form-group">
                                    <label for="currency" th:text="#{payment.currency}">Currency:</label>
                                    <select id="currency" name="currency">
                                        <option value="EUR">EUR</option>
                                        <option value="USD">USD</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="note" th:text="#{payment.note}">Note:</label>
                                    <textarea id="note" name="note" th:placeholder="#{payment.note.placeholder}"></textarea>
                                </div>

                                <div class="modal-actions">
                                    <button type="button" class="btn-cancel" id="cancelPayment" th:text="#{button.cancel}">Cancel</button>
                                    <button type="submit" class="btn-send" th:text="#{button.sendLink}">Send Link</button>
                                </div>
                            </form>

                            <div id="paymentResult" class="hidden">
                                <p th:text="#{payment.link.generated}">Payment link generated:</p>
                                <a id="paymentLink" href="#" target="_blank"></a>
                                <button id="closeResult" class="btn-send" th:text="#{button.close}">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="col-md-8">
            <div class="panel transactions-table-wrapper">
                <div class="transactions-header">
                    <h3 class="transactions-title">
                        <i class="bi bi-receipt"></i>
                        <span th:text="#{transaction.history}">Transaction History</span>
                    </h3>

                    <div class="filter-controls">
                        <div class="filter-group">
                            <label class="filter-label" th:text="#{filter.dateRange}">Date Range:</label>
                            <select class="filter-select" id="dateFilter">
                                <option value="all" th:text="#{filter.date.all}">All Time</option>
                                <option value="today" th:text="#{filter.date.today}">Today</option>
                                <option value="week" th:text="#{filter.date.week}">Last 7 Days</option>
                                <option value="month" th:text="#{filter.date.month}">Last Month</option>
                                <option value="quarter" th:text="#{filter.date.quarter}">Last 3 Months</option>
                                <option value="year" th:text="#{filter.date.year}">Last Year</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label" th:text="#{filter.status}">Status:</label>
                            <select class="filter-select" id="statusFilter">
                                <option value="all" th:text="#{filter.status.all}">All Status</option>
                                <option value="SUCCEEDED" th:text="#{transaction.status.SUCCEEDED}">Succeeded</option>
                                <option value="PENDING" th:text="#{transaction.status.PENDING}">Pending</option>
                                <option value="FAILED" th:text="#{transaction.status.FAILED}">Failed</option>
                                <option value="EXPIRED" th:text="#{transaction.status.EXPIRED}">Expired</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label" th:text="#{transaction.type}">Type:</label>
                            <select class="filter-select" id="typeFilter">
                                <option value="all" th:text="#{filter.type.all}">All Types</option>
                                <option value="MEMBERSHIP_FEE" th:text="#{transaction.type.MEMBERSHIP_FEE}">Membership Fee</option>
                                <option value="EVENT_PAYMENT" th:text="#{transaction.type.EVENT_PAYMENT}">Event Payment</option>
                                <option value="DONATION" th:text="#{transaction.type.DONATION}">Donation</option>
                                <option value="OTHER" th:text="#{transaction.type.OTHER}">Other</option>
                            </select>
                        </div>


                        <button class="filter-reset-btn" id="resetFilters">
                            <i class="bi bi-arrow-clockwise"></i>
                            <span th:text="#{button.reset}">Reset</span>
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="transactions-table" id="transactionsTable">
                        <thead>
                        <tr>
                            <th class="sortable" data-column="date">
                                <i class="bi bi-calendar3"></i>
                                <span th:text="#{transaction.date}">Date</span>
                            </th>
                            <th class="sortable" data-column="type">
                                <i class="bi bi-tag"></i>
                                <span th:text="#{transaction.type}">Type</span>
                            </th>
                            <th class="sortable" data-column="amount">
                                <i class="bi bi-currency-dollar"></i>
                                <span th:text="#{transaction.amount}">Amount</span>
                            </th>
                            <th class="sortable" data-column="currency">
                                <i class="bi bi-cash"></i>
                                <span th:text="#{transaction.currency}">Currency</span>
                            </th>
                            <th class="sortable" data-column="status">
                                <i class="bi bi-check-circle"></i>
                                <span th:text="#{transaction.status}">Status</span>
                            </th>
                        </tr>
                        </thead>
                        <tbody id="transactionsBody">
                        <tr th:each="tx : ${member.transactions}">
                            <td class="date-cell" th:text="${#temporals.format(tx.createdAt, 'dd/MM/yyyy HH:mm')}"></td>
                            <td class="type-cell" th:text="#{${'transaction.type.' + tx.type}}" th:data-type="${tx.type}">Membership Fee</td>
                            <td class="amount-cell" th:text="${tx.amount}"></td>
                            <td class="currency-cell" th:text="${tx.currency}"></td>
                            <td class="status-cell">
                                <span th:text="#{${'transaction.status.' + tx.status}}"
                                      th:class="'status-pill ' + ${tx.status}"
                                      th:data-status="${tx.status}">Succeeded</span>
                                                        </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(member.transactions)}" class="no-data-row">
                            <td colspan="5" class="text-center">
                                <i class="bi bi-inbox" style="font-size: 2rem; color: #cbd5e0; margin-bottom: 0.5rem;"></i><br>
                                <span th:text="#{transaction.none}">No transactions found</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
