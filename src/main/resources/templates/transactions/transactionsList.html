<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{transaction.list.title}">Transactions List</title>
    <link rel="stylesheet" th:href="@{/css/sidebar.css}" />
    <link rel="stylesheet" th:href="@{/css/transactionsList.css}" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script th:src="@{/js/sidebar.js}" defer></script>
</head>
<body>

<!-- Sidebar -->
<div th:replace="~{fragments :: sidebar}"></div>

<!-- Main content -->
<main class="transactions-container">
    <!-- Header section -->
    <div class="transactions-header">
        <h1 class="title" th:text="#{transaction.list.header}">Transactions</h1>
        <div class="header-actions">
            <form id="filterForm" method="get" action="/transactions" class="filters-container">
                <input type="hidden" name="sort" th:value="${sort}" id="sortInput">
                <input type="hidden" name="direction" th:value="${direction}" id="directionInput">

                <div class="status-filter">
                    <select name="status" id="statusFilter">
                        <option value="" th:text="#{filter.status.all}">All Status</option>
                        <option value="PENDING" th:selected="${status == 'PENDING'}" th:text="#{transaction.status.PENDING}">Pending</option>
                        <option value="SUCCEEDED" th:selected="${status == 'SUCCEEDED'}" th:text="#{transaction.status.SUCCEEDED}">Succeeded</option>
                        <option value="FAILED" th:selected="${status == 'FAILED'}" th:text="#{transaction.status.FAILED}">Failed</option>
                        <option value="EXPIRED" th:selected="${status == 'EXPIRED'}" th:text="#{transaction.status.EXPIRED}">Expired</option>
                    </select>
                </div>

                <div class="type-filter">
                    <select name="type" id="typeFilter">
                        <option value="" th:text="#{filter.type.all}">All Types</option>
                        <option value="MEMBERSHIP_FEE" th:selected="${type == 'MEMBERSHIP_FEE'}" th:text="#{transactionType.MEMBERSHIP_FEE}">Membership Fee</option>
                        <option value="DONATION" th:selected="${type == 'DONATION'}" th:text="#{transactionType.DONATION}">Donation</option>
                        <option value="EVENT_PAYMENT" th:selected="${type == 'EVENT_PAYMENT'}" th:text="#{transactionType.EVENT_PAYMENT}">Event Payment</option>
                        <option value="OTHER" th:selected="${type == 'OTHER'}" th:text="#{transactionType.OTHER}">Other</option>
                    </select>
                </div>

                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" name="search" id="searchInput" th:placeholder="#{transaction.search.placeholder}" th:value="${search}">
                </div>
            </form>
        </div>
    </div>

    <!-- Transactions table -->
    <div class="transactions-table-wrapper">
        <table class="transactions-table">
            <thead>
            <tr>
                <th class="sortable" data-column="member.firstName">
                    <span th:text="#{transaction.table.member}">Member</span>
                    <i class="fas fa-sort"
                       th:classappend="${sort == 'member.firstName'} ? (${direction == 'asc'} ? 'fa-sort-up' : 'fa-sort-down') : 'fa-sort'"></i>
                </th>
                <th class="sortable" data-column="amount">
                    <span th:text="#{transaction.table.amount}">Amount</span>
                    <i class="fas fa-sort"
                       th:classappend="${sort == 'amount'} ? (${direction == 'asc'} ? 'fa-sort-up' : 'fa-sort-down') : 'fa-sort'"></i>
                </th>
                <th class="sortable" data-column="type">
                    <span th:text="#{transaction.table.type}">Type</span>
                    <i class="fas fa-sort"
                       th:classappend="${sort == 'type'} ? (${direction == 'asc'} ? 'fa-sort-up' : 'fa-sort-down') : 'fa-sort'"></i>
                </th>
                <th class="sortable" data-column="status">
                    <span th:text="#{transaction.table.status}">Status</span>
                    <i class="fas fa-sort"
                       th:classappend="${sort == 'status'} ? (${direction == 'asc'} ? 'fa-sort-up' : 'fa-sort-down') : 'fa-sort'"></i>
                </th>
                <th class="sortable" data-column="createdAt">
                    <span th:text="#{transaction.table.date}">Date</span>
                    <i class="fas fa-sort"
                       th:classappend="${sort == 'createdAt'} ? (${direction == 'asc'} ? 'fa-sort-up' : 'fa-sort-down') : 'fa-sort'"></i>
                </th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="transaction : ${transactionsPage.content}">
                <td>
                    <span th:text="${transaction.member.firstName + ' ' + transaction.member.lastName}">John Doe</span>
                </td>
                <td class="amount">
                    <span th:text="${#numbers.formatDecimal(transaction.amount, 1, 2) + ' ' + transaction.currency}">â‚¬25.00</span>
                </td>
                <td>
                    <span class="type-pill"
                          th:classappend="${transaction.type.name()}"
                          th:text="#{${'transactionType.' + transaction.type.name()}}">MEMBERSHIP_FEE</span>
                </td>
                <td>
                    <span th:classappend="${transaction.status.name() == 'SUCCEEDED'} ? 'status-pill succeeded' :
                                         (${transaction.status.name() == 'PENDING'} ? 'status-pill pending' :
                                         (${transaction.status.name() == 'FAILED'} ? 'status-pill failed' : 'status-pill expired'))"
                          th:text="#{${'transaction.status.' + transaction.status.name()}}">Succeeded</span>
                </td>
                <td class="date">
                    <span th:text="${#temporals.format(transaction.createdAt, 'dd/MM/yyyy HH:mm')}">12/09/2025 14:30</span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="pagination">
        <a th:if="${transactionsPage.number > 0}"
           th:href="@{/transactions(page=${transactionsPage.number - 1}, size=${transactionsPage.size}, search=${search}, status=${status}, type=${type}, sort=${sort}, direction=${direction})}">
            <i class="fas fa-chevron-left"></i> <span th:text="#{pagination.previous}">Previous</span>
        </a>

        <span th:text="#{pagination.page}">Page</span>
        <strong th:text="${transactionsPage.number + 1}">1</strong>
        <span th:text="#{pagination.of}">of</span>
        <strong th:text="${transactionsPage.totalPages}">1</strong>

        <a th:if="${transactionsPage.number + 1 < transactionsPage.totalPages}"
           th:href="@{/transactions(page=${transactionsPage.number + 1}, size=${transactionsPage.size}, search=${search}, status=${status}, type=${type}, sort=${sort}, direction=${direction})}">
            <span th:text="#{pagination.next}">Next</span> <i class="fas fa-chevron-right"></i>
        </a>
    </div>
</main>
</body>
</html>
